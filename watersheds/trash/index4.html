<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>RIPPLES TEST</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    
    <style>
    body{ top: 0; left: 0; margin: 0;}
    </style>
</head>
<body>
	<script>
        
        function Timer() {

        this.current = performance.now();
        this.last = 0;
        this.theta = 0;
            
        this.frame;

        this.update = function() {

        this.last = this.current;
        this.current = performance.now();
        //this.frame = this.current - this.last;
        this.theta += this.getInterval();
            
        if(this.theta > interval) { 
   
            this.theta = 0; 
            
            if(g1 != undefined){
                
                var lastX =  g1.select("#particle").attr("cx");
                var lastY =  g1.select("#particle").attr("cy");
                d3.selectAll("#copy").remove();
                
            }
            
            g1 = svg.append("g").html(g0.html()).attr("id", "copy").attr("transform", "translate(" + width/2 + ", 0)");
            g1.select("#particle").datum(g0.select("#particle").datum());
     
            var c2 = g1.select("#particle");
            c2.attr("cx", lastX)
            .attr("cy", lastY)
            .transition()
            .ease("exp")
            .duration(2500)
            .attr("cx", g0.select("#particle").attr("cx"))
            .attr("cy", g0.select("#particle").attr("cy"));
                                   
        }

        }

        this.getInterval = function() {
        return performance.now() - this.last;
        }

        }
        
        var frame = 0;
        
        var interval = 2500;
        var t = new Timer();
        
        var g0, g1, buffer;
        
        var velocity = {x: Math.random() * 3.0, y: Math.random() * 3.0};
        
        var width = window.innerWidth;
        var height = window.innerHeight;
        
        var svg = d3.select("body").append("svg")
       .attr("width", width)
       .attr("height", height);
        
       g0 = svg.append("g")
                 .attr("width", width/2)
                 .attr("height", height)
                 .attr("transform", "translate(0, 0)");
        
       var back = g0.append("rect") 
                  .attr("x", 0)
                  .attr("y", 0)
                  .attr("width", g0.attr("width"))
                  .attr("height", g0.attr("height"))
                  .attr("fill", "#FF00FF");
        
        var circle = g0.append("circle")
                     .datum({lastX: 99, lastY: 99})
                     .attr("id", "particle", true)
                     .attr("cx", g0.attr("width") / 2)
                     .attr("cy", g0.attr("height") / 2)
                     .attr("r", 32)
                     .attr("fill", "#00FFFF");
       

        render();
        
        function render(){
            
            t.update();
            
            //update original
            //var c = d3.select("#particle");
            if(circle.attr("cx") < 0 || circle.attr("cx") > g0.attr("width")) velocity.x *= -1;
            if(circle.attr("cy") < 0 || circle.attr("cy") > g0.attr("height")) velocity.y *= -1;
            circle.attr("cx", Number(circle.attr("cx")) + velocity.x);
            circle.attr("cy", Number(circle.attr("cy")) + velocity.y);
           
            window.requestAnimationFrame(render);
            
            frame++;
            
        }
        
	</script>
</body>
</html>